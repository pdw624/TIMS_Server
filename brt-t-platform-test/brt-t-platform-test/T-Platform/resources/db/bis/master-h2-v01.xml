<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BisLoader">
	<insert id="codeGroupItem" parameterType="HashMap">
		INSERT INTO BIS_MT_GRP_CODE(GROUP_CD, GROUP_NAME1, GROUP_NAME2)
		VALUES(#{GROUP_CD}, #{GROUP_NAME1}, #{GROUP_NAME2})
	</insert>

	<insert id="codeDetailItem" parameterType="HashMap">
		INSERT INTO BIS_MT_DTL_CODE(GROUP_CD, DETAIL_CD, DETAIL_NAME1, DETAIL_NAME2)
		VALUES(#{GROUP_CD}, #{DETAIL_CD}, #{DETAIL_NAME1}, #{DETAIL_NAME2})
	</insert>

	<insert id="busItem" parameterType="HashMap">
		INSERT INTO BIS_MT_BUS(BUS_ID, BUS_NAME, BUS_TYPE, IMP_ID, IMP_TYPE)
		VALUES(#{BUS_ID}, #{BUS_NAME}, #{BUS_TYPE}, #{IMP_ID}, #{IMP_TYPE})
	</insert>

	<insert id="bitItem" parameterType="HashMap">
		INSERT INTO BIS_MT_BIT(STATION_ID, STATION_NAME1, STATION_NAME2, STATION_TYPE, BIT_ID, BIT_TYPE, NODE_ID)
		VALUES(#{STATION_ID}, #{STATION_NAME1}, #{STATION_NAME2}, #{STATION_TYPE}, #{BIT_ID}, #{BIT_TYPE}, #{NODE_ID})
	</insert>

	<insert id="routeItem" parameterType="HashMap">
		INSERT INTO BIS_MT_ROUTE(ROUTE_ID, ROUTE_NAME1, ROUTE_NAME2, ROUTE_TYPE, ROUTE_LENGTH, RUN_TYPE, JOURNEY_TIME)
		VALUES(#{ROUTE_ID}, #{ROUTE_NAME1}, #{ROUTE_NAME2}, #{ROUTE_TYPE}, #{ROUTE_LENGTH}, #{RUN_TYPE}, #{JOURNEY_TIME})
	</insert>

	<insert id="routePlan" parameterType="HashMap">
		INSERT INTO BIS_MT_ROUTE_PLAN(ROUTE_ID, DAY_TYPE, SERVICE_COUNT, ST_FIRST_TIME, ST_LAST_TIME,
			ED_FIRST_TIME, ED_LAST_TIME, MIN_INTERVAL, MAX_INTERVAL)
		VALUES(#{ROUTE_ID}, #{DAY_TYPE}, #{SERVICE_COUNT}, #{ST_FIRST_TIME}, #{ST_LAST_TIME},
			#{ED_FIRST_TIME}, #{ED_LAST_TIME}, #{MIN_INTERVAL}, #{MAX_INTERVAL})
	</insert>

	<insert id="stationItem" parameterType="HashMap">
		INSERT INTO BIS_MT_STATION(STATION_ID, STATION_NAME1, STATION_NAME2, STATION_TYPE, LAT, LON, NODE_ID)
		VALUES(#{STATION_ID}, #{STATION_NAME1}, #{STATION_NAME2}, #{STATION_TYPE}, #{LAT}, #{LON}, #{NODE_ID})
	</insert>

	<insert id="linkItem" parameterType="HashMap">
		INSERT INTO BIS_MT_LINK(LINK_ID, LINK_NAME1, LINK_NAME2, LINK_TYPE, FROM_NODE_ID, TO_NODE_ID,
			LINK_LENGTH, LANE_COUNT, MAX_SPEED, IN_ANGLE, OUT_ANGLE)
		VALUES(#{LINK_ID}, #{LINK_NAME1}, #{LINK_NAME2}, #{LINK_TYPE}, #{FROM_NODE_ID}, #{TO_NODE_ID},
			#{LINK_LENGTH}, #{LANE_COUNT}, #{MAX_SPEED}, #{IN_ANGLE}, #{OUT_ANGLE})
	</insert>

	<insert id="nodeItem" parameterType="HashMap">
		INSERT INTO BIS_MT_NODE(NODE_ID, NODE_NAME1, NODE_NAME2, NODE_TYPE, LAT, LON, IN_RADIUS, OUT_RADIUS)
		VALUES(#{NODE_ID}, #{NODE_NAME1}, #{NODE_NAME2}, #{NODE_TYPE}, #{LAT}, #{LON}, #{IN_RADIUS}, #{OUT_RADIUS})
	</insert>

	<insert id="routeLinkItem" parameterType="HashMap">
		INSERT INTO BIS_MT_ROUTE_LINK(ROUTE_ID, LINK_SEQ, LINK_ID, UPDOWN_DIR)
		VALUES(#{ROUTE_ID}, #{LINK_SEQ}, #{LINK_ID}, #{UPDOWN_DIR})
	</insert>

	<insert id="routeStationItem" parameterType="HashMap">
		INSERT INTO BIS_MT_ROUTE_STATION(ROUTE_ID, STATION_SEQ, STATION_ID, UPDOWN_DIR)
		VALUES(#{ROUTE_ID}, #{STATION_SEQ}, #{STATION_ID}, #{UPDOWN_DIR})
	</insert>

	<insert id="routeNodeItem" parameterType="HashMap">
		INSERT INTO BIS_MT_ROUTE_NODE(ROUTE_ID, NODE_SEQ, NODE_ID, UPDOWN_DIR)
		VALUES(#{ROUTE_ID}, #{NODE_SEQ}, #{NODE_ID}, #{UPDOWN_DIR})
	</insert>

	<insert id="linkVertexItem" parameterType="HashMap">
		INSERT INTO BIS_MT_LINK_VERTEX(LINK_ID, VERTEX_SEQ, LAT, LON)
		VALUES(#{LINK_ID}, #{VERTEX_SEQ}, #{LAT}, #{LON})
	</insert>

	<insert id="allInfoItem">
		INSERT INTO BIS_MT_ALL_INFO
			SELECT T1.ROUTE_ID, T1.ROUTE_TYPE,
				T1.NODE_SEQ, T1.NODE_ID, T1.NODE_TYPE,
				T2.LINK_SEQ, T2.LINK_ID, T2.LINK_TYPE, T2.LINK_LENGTH,
				T3.STATION_SEQ, T3.STATION_ID, T3.STATION_TYPE, T3.BIT_ID, T3.BIT_TYPE
			FROM (
				SELECT TA1.ROUTE_ID, TA1.ROUTE_TYPE, TA2.NODE_SEQ, TA2.NODE_ID, TA3.NODE_TYPE, TA2 .UPDOWN_DIR
				FROM BIS_MT_ROUTE TA1
				INNER JOIN BIS_MT_ROUTE_NODE TA2 ON TA1.ROUTE_ID = TA2.ROUTE_ID
				INNER JOIN BIS_MT_NODE TA3 ON TA2.NODE_ID = TA3.NODE_ID
			) T1
			LEFT JOIN (
				SELECT TB1.ROUTE_ID, TB1.LINK_SEQ, TB2.LINK_ID, TB2.LINK_TYPE, TB2.LINK_LENGTH
				FROM BIS_MT_ROUTE_LINK TB1
				INNER JOIN BIS_MT_LINK TB2 ON TB1.LINK_ID = TB2.LINK_ID
			) T2 ON T2.ROUTE_ID = T1.ROUTE_ID AND T2.LINK_SEQ = T1.NODE_SEQ-1
			LEFT JOIN (
				SELECT TC1.ROUTE_ID, TC1.STATION_SEQ, TC2.STATION_ID, TC2.STATION_TYPE, TC2.NODE_ID, TC1.UPDOWN_DIR, TC3.BIT_ID, TC3.BIT_TYPE
				FROM BIS_MT_ROUTE_STATION TC1
				INNER JOIN BIS_MT_STATION TC2 ON TC1.STATION_ID = TC2.STATION_ID
				LEFT JOIN BIS_MT_BIT TC3 ON TC2.STATION_ID = TC3.STATION_ID
			) T3 ON T3.ROUTE_ID = T1.ROUTE_ID AND T3.NODE_ID = T1.NODE_ID AND T3.UPDOWN_DIR = T1.UPDOWN_DIR
			ORDER BY T1.ROUTE_ID, T1.NODE_SEQ
	</insert>

</mapper>
